<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆæŒ‡ä»¤ãƒ»é˜²ç½ã‚·ã‚¹ãƒ†ãƒ  | Integrated Command & Disaster Prevention</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20n6sB8s5eOaRW88AxZfSjSH2yAHDvR+y2ftc8wQRV2M="
            crossorigin=""></script>
            
    <style>
        /* == COMMAND CENTER STYLING == */
        :root {
            --bg-color: #121212;
            --main-text-color: #00ffcc; /* ãƒã‚ªãƒ³ã‚°ãƒªãƒ¼ãƒ³ */
            --panel-bg: #1e1e1e;
            --border-color: #333;
            --warning-color: #ffcc00; /* é»„è‰² */
            --danger-color: #ff3333; /* èµ¤è‰² */
            --normal-color: #0099ff; /* é’è‰² */
            --font-mono: 'Roboto Mono', monospace;
        }
        body {
            font-family: var(--font-mono);
            background-color: var(--bg-color);
            color: var(--main-text-color);
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            font-size: 14px;
        }
        .header {
            width: 100%;
            background-color: #000;
            color: var(--main-text-color);
            padding: 10px 20px;
            font-size: 1.5em;
            text-align: center;
            border-bottom: 2px solid var(--main-text-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0;
            z-index: 1000;
        }
        .container {
            display: flex;
            width: 100%;
            padding-top: 55px; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•åˆ†èª¿æ•´ */
            flex-grow: 1; /* ã‚³ãƒ³ãƒ†ãƒŠãŒæ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ã™ã¹ã¦å ã‚ã‚‹ã‚ˆã†ã« */
        }

        /* å·¦å´ãƒ‘ãƒãƒ« (åœ°å›³ & é‹è¡Œæƒ…å ±) */
        .left-column {
            flex: 2; /* 2/3ã®å¹… */
            display: flex;
            flex-direction: column;
            height: calc(100vh - 55px); /* **ä¿®æ­£**: è¦ªè¦ç´ ã®é«˜ã•ã‚’ç¢ºä¿ */
        }
        #map {
            flex-grow: 1;
            background: #000;
            border-right: 2px solid var(--border-color);
        }
        #weather-display {
            padding: 15px;
            background-color: var(--panel-bg);
            border-top: 1px solid var(--border-color);
            min-height: 100px;
        }

        /* å³å´ãƒ‘ãƒãƒ« (åˆ¶å¾¡ & ãƒ­ã‚°) */
        .right-column {
            flex: 1; /* 1/3ã®å¹… */
            display: flex;
            flex-direction: column;
            padding: 15px;
            background-color: var(--panel-bg);
            border-left: 2px solid var(--border-color);
            overflow-y: auto;
            height: calc(100vh - 55px); /* **è¿½åŠ **: è¦ªè¦ç´ ã®é«˜ã•ã‚’ç¢ºä¿ */
        }
        .panel {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: #282828;
        }
        h2 {
            margin-top: 0;
            color: var(--normal-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            font-size: 1.1em;
        }

        /* é‹è¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        #line-status-display div {
            padding: 8px;
            margin-bottom: 5px;
            border-left: 5px solid;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
        .status-normal { border-color: var(--main-text-color); color: var(--main-text-color); }
        .status-delayed { border-color: var(--warning-color); color: var(--warning-color); }
        .status-stopped { border-color: var(--danger-color); color: var(--danger-color); }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .control-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .control-input input[type="text"] {
            padding: 8px;
            border: 1px solid var(--border-color);
            background-color: #383838;
            color: var(--main-text-color);
            border-radius: 3px;
            flex-grow: 1;
        }
        .control-input select, .control-input button {
            padding: 8px;
            border: 1px solid var(--border-color);
            background-color: #383838;
            color: var(--main-text-color);
            cursor: pointer;
            border-radius: 3px;
        }
        .control-input select { flex-grow: 1; }
        .control-input button:hover { background-color: var(--border-color); }
        .full-width-button {
            width: 100%;
            margin-top: 5px;
        }

        /* ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
        #event-log {
            flex-grow: 1;
            height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            padding: 10px;
            background-color: #000;
        }
        .log-entry {
            padding: 3px 0;
            border-bottom: 1px dotted #333;
        }
        .log-warn { color: var(--warning-color); }
        .log-alert { color: var(--danger-color); font-weight: bold; }
        .log-info { color: var(--normal-color); }
    </style>
</head>
<body>
    <div class="header">
        çµ±åˆæŒ‡ä»¤ãƒ»é˜²ç½ã‚·ã‚¹ãƒ†ãƒ  V1.0 (Integrated Command & Disaster Prevention)
    </div>

    <div class="container">
        <div class="left-column">
            <div id="map"></div>
            <div id="weather-display" class="panel">
                <h2>ğŸ“¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ°—è±¡æƒ…å ±</h2>
                <div id="weather-info">åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€GPSãƒœã‚¿ãƒ³ã§åœ°ç‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</div>
                <button class="full-width-button" onclick="getGPSLocation()">ç¾åœ¨åœ°ã‚’è¦³æ¸¬åœ°ç‚¹ã«è¨­å®š (GPS)</button>
            </div>
        </div>

        <div class="right-column">
            <div class="panel">
                <h2>ğŸš¦ é‹è¡ŒçŠ¶æ³ã‚µãƒãƒªãƒ¼</h2>
                <div id="line-status-display">
                    </div>
            </div>

            <div class="panel">
                <h2>âš ï¸ é‹è¡ŒæŒ‡ä»¤ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)</h2>
                <div class="control-input">
                    <select id="line-select"></select>
                    <select id="status-select">
                        <option value="normal">é€šå¸¸é‹è»¢</option>
                        <option value="delayed">é…å»¶</option>
                        <option value="stopped">é‹è»¢è¦‹åˆã‚ã›</option>
                    </select>
                </div>
                <div class="control-input">
                    <input type="text" id="delay-input" placeholder="é…å»¶æ™‚é–“ (ä¾‹: 15åˆ†, 3æ™‚é–“)">
                </div>
                <div class="control-input">
                    <button onclick="updateLineStatus()">é‹è¡ŒçŠ¶æ³æ›´æ–°</button>
                    <button onclick="simulateDisasterEvent()">ç½å®³ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ</button>
                </div>
            </div>

            <div class="panel" style="flex-grow: 1;">
                <h2>ğŸ“œ ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°</h2>
                <div id="event-log"></div>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®š
        const OPEN_WEATHER_API_KEY = "YOUR_OPENWEATHERMAP_API_KEY"; // **ã”è‡ªèº«ã®APIã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„**
        const MAP_DEFAULT_CENTER = [35.6895, 139.6917]; // æ±äº¬é§…å‘¨è¾ºã‚’åˆæœŸä¸­å¿ƒã«è¨­å®š
        const INITIAL_ZOOM = 10;
        
        // é‹è¡Œè·¯ç·šãƒ‡ãƒ¼ã‚¿ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨)
        let lines = {
            'Line_A': { id: 'Line_A', name: 'æ±æ—¥æœ¬ãƒ©ã‚¤ãƒ³A', status: 'normal', delay: 'å®šåˆ»', lat: 35.70, lon: 139.75, marker: null },
            'Line_B': { id: 'Line_B', name: 'æ±æ—¥æœ¬ãƒ©ã‚¤ãƒ³B', status: 'normal', delay: 'å®šåˆ»', lat: 35.55, lon: 139.60, marker: null },
            'Line_C': { id: 'Line_C', name: 'è¥¿æ—¥æœ¬ãƒ©ã‚¤ãƒ³C', status: 'normal', delay: 'å®šåˆ»', lat: 34.69, lon: 135.50, marker: null }
        };

        // DOMè¦ç´ 
        const lineStatusDisplayEl = document.getElementById('line-status-display');
        const lineSelectEl = document.getElementById('line-select');
        const statusSelectEl = document.getElementById('status-select');
        const delayInputEl = document.getElementById('delay-input'); // **è¿½åŠ **
        const weatherInfoEl = document.getElementById('weather-info');
        const eventLogEl = document.getElementById('event-log');

        let map = null;
        let weatherMarker = null;

        // =========================================================
        // I. åˆæœŸåŒ–
        // =========================================================

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            initLineStatusDisplay();
            renderLineStatus();
            logEvent("ã‚·ã‚¹ãƒ†ãƒ ", "èµ·å‹•å®Œäº†ã€‚åœ°å›³ã€é‹è¡Œæƒ…å ±ã€åˆ¶å¾¡ãƒ‘ãƒãƒ«ã®åˆæœŸåŒ–ã«æˆåŠŸã€‚", "info");
        });

        function initMap() {
            // Leafletãƒãƒƒãƒ—ã®åˆæœŸåŒ–
            map = L.map('map').setView(MAP_DEFAULT_CENTER, INITIAL_ZOOM);

            // **ä¿®æ­£**: åœ°å›³ã®ã‚µã‚¤ã‚ºã‚’å¼·åˆ¶çš„ã«æ›´æ–°
            setTimeout(() => {
                map.invalidateSize();
            }, 100); 

            // OpenStreetMapã®ã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            // ãƒãƒƒãƒ—ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            map.on('click', onMapClick);

            // è·¯ç·šãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
            Object.keys(lines).forEach(key => {
                const line = lines[key];
                // ãƒãƒ¼ã‚«ãƒ¼ã®è‰²ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¿œã˜ã¦è¨­å®š
                const color = getMarkerColor(line.status); 
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div style="background-color: ${color}; width: 15px; height: 15px; border-radius: 50%; border: 2px solid white;"></div>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });

                const marker = L.marker([line.lat, line.lon], { icon: icon }).addTo(map)
                    .bindPopup(`<b>${line.name}</b><br>é‹è¡ŒçŠ¶æ³: ${line.status === 'normal' ? 'é€šå¸¸' : 'ç•°å¸¸'}`);
                
                line.marker = marker; // ãƒãƒ¼ã‚«ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ã«ä¿æŒ
            });
        }
        
        function getMarkerColor(status) {
            switch(status) {
                case 'normal': return '#00ffcc';
                case 'delayed': return '#ffcc00';
                case 'stopped': return '#ff3333';
                default: return '#cccccc';
            }
        }

        function updateMarker(line) {
            const color = getMarkerColor(line.status);
            const icon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div style="background-color: ${color}; width: 15px; height: 15px; border-radius: 50%; border: 2px solid white;"></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            line.marker.setIcon(icon);
            line.marker.setPopupContent(`<b>${line.name}</b><br>é‹è¡ŒçŠ¶æ³: ${line.status === 'normal' ? 'é€šå¸¸' : 'ç•°å¸¸'}<br>é…å»¶: ${line.delay}`);
        }

        function initLineStatusDisplay() {
            Object.keys(lines).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = lines[key].name;
                lineSelectEl.appendChild(option);
            });
        }


        // =========================================================
        // II. åœ°å›³ãƒ»æ°—è±¡æƒ…å ± (å¤–éƒ¨APIé€£æº)
        // =========================================================
        
        function onMapClick(e) {
            const lat = e.latlng.lat;
            const lon = e.latlng.lng;
            setWeatherLocation(lat, lon, "åœ°å›³ã‚¯ãƒªãƒƒã‚¯");
        }
        
        // **æ–°æ©Ÿèƒ½**: GPSç¾åœ¨åœ°å–å¾—
        function getGPSLocation() {
            if (!navigator.geolocation) {
                logEvent("åœ°ç†æƒ…å ±", "ã‚¨ãƒ©ãƒ¼: ãƒ–ãƒ©ã‚¦ã‚¶ãŒGPS (Geolocation) ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚", "alert");
                return;
            }

            weatherInfoEl.innerHTML = "GPSãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...";

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    setWeatherLocation(lat, lon, "GPSç¾åœ¨åœ°");
                    map.setView([lat, lon], 12); // åœ°å›³ã‚’ç¾åœ¨åœ°ã«ç§»å‹•
                },
                (error) => {
                    logEvent("åœ°ç†æƒ…å ±", `GPSå–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, "alert");
                    weatherInfoEl.innerHTML = `<span style="color: var(--danger-color);">GPSå–å¾—å¤±æ•—ã€‚æ‰‹å‹•ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚</span>`;
                }
            );
        }

        function setWeatherLocation(lat, lon, source) {
            logEvent("åœ°ç†æƒ…å ±", `${source}åº§æ¨™ã‚’è¨­å®š: Lat ${lat.toFixed(4)}, Lon ${lon.toFixed(4)}`, "info");

            // ãƒãƒ¼ã‚«ãƒ¼ã‚’æ›´æ–°ã¾ãŸã¯æ–°è¦ä½œæˆ
            const latlng = [lat, lon];
            if (weatherMarker) {
                weatherMarker.setLatLng(latlng);
            } else {
                weatherMarker = L.marker(latlng).addTo(map)
                    .bindPopup("æ°—è±¡è¦³æ¸¬åœ°ç‚¹").openPopup();
            }

            // æ°—è±¡æƒ…å ±ã‚’å–å¾—
            fetchWeather(lat, lon);
        }


        async function fetchWeather(lat, lon) {
            if (OPEN_WEATHER_API_KEY === "YOUR_OPENWEATHERMAP_API_KEY") {
                weatherInfoEl.innerHTML = `<span style="color: var(--danger-color);">âš ï¸ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å¤©æ°—æƒ…å ±ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚</span>`;
                return;
            }

            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OPEN_WEATHER_API_KEY}&units=metric&lang=ja`;

            try {
                weatherInfoEl.innerHTML = "ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...";
                const response = await fetch(url);
                const data = await response.json();

                if (data.cod !== 200) {
                    throw new Error(data.message || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼");
                }

                // æ‘‚æ°ã«å¤‰æ›
                const tempC = data.main.temp.toFixed(1);
                const weatherDesc = data.weather[0].description;
                const windSpeed = data.wind.speed.toFixed(1);

                weatherInfoEl.innerHTML = `
                    <p><b>åœ°ç‚¹: ${data.name || 'æœªç™»éŒ²åœ°ç‚¹'}</b></p>
                    <p>æ°—æ¸©: ${tempC} â„ƒ</p>
                    <p>å¤©å€™: ${weatherDesc}</p>
                    <p>é¢¨é€Ÿ: ${windSpeed} m/s</p>
                `;
                
                // å¼·é¢¨æ³¨æ„å ±ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                if (windSpeed >= 15) {
                    logEvent("æ°—è±¡è­¦å ±", `å¼·é¢¨æ³¨æ„å ±: ${data.name}ã§é¢¨é€Ÿ ${windSpeed}m/sã‚’è¦³æ¸¬ã€‚é‹è¡Œã«å½±éŸ¿ã®å¯èƒ½æ€§ã€‚`, "alert");
                }

            } catch (error) {
                weatherInfoEl.innerHTML = `<span style="color: var(--danger-color);">ã‚¨ãƒ©ãƒ¼: æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•— (${error.message})</span>`;
                logEvent("æ°—è±¡è­¦å ±", `æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error.message}`, "alert");
            }
        }

        // =========================================================
        // III. é‹è¡ŒæŒ‡ä»¤ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        // =========================================================
        
        function renderLineStatus() {
            lineStatusDisplayEl.innerHTML = '';
            Object.keys(lines).forEach(key => {
                const line = lines[key];
                const statusClass = line.status === 'normal' ? 'status-normal' : 
                                    line.status === 'delayed' ? 'status-delayed' : 'status-stopped';
                
                const statusText = line.status === 'normal' ? 'é€šå¸¸' : 
                                   line.status === 'delayed' ? 'é…å»¶ä¸­' : 'è¦‹åˆã‚ã›';
                
                const delayText = line.delay === 'å®šåˆ»' ? '' : ` (${line.delay})`;

                const div = document.createElement('div');
                div.className = statusClass;
                div.innerHTML = `
                    <span>${line.name}</span>
                    <span>${statusText}${delayText}</span>
                `;
                lineStatusDisplayEl.appendChild(div);
                
                // ãƒãƒ¼ã‚«ãƒ¼ã®æ›´æ–°
                if (line.marker) updateMarker(line);
            });
        }

        function updateLineStatus() {
            const lineId = lineSelectEl.value;
            const newStatus = statusSelectEl.value;
            const lineName = lines[lineId].name;
            const customDelay = delayInputEl.value.trim(); // **æ–°æ©Ÿèƒ½**: é…å»¶æ™‚é–“å…¥åŠ›

            let logMessage = "";
            let logType = "info";

            lines[lineId].status = newStatus;
            
            if (newStatus === 'delayed') {
                lines[lineId].delay = customDelay || 'ç´„15åˆ†';
                logMessage = `${lineName}ã«å¯¾ã—ã€é‹è¡Œé…å»¶ (${lines[lineId].delay}) ã‚’æŒ‡ä»¤ã€‚è¦å› èª¿æŸ»ä¸­ã€‚`;
                logType = "warn";
            } else if (newStatus === 'stopped') {
                lines[lineId].delay = 'ä¸æ˜';
                logMessage = `ğŸš¨ ${lineName}ã«å¯¾ã—ã€å…¨ç·šé‹è»¢è¦‹åˆã‚ã›ã‚’æŒ‡ä»¤ã€‚ç›´ã¡ã«ä»£æ›¿è¼¸é€æ‰‹æ®µã‚’ç¢ºä¿ã›ã‚ˆã€‚`;
                logType = "alert";
            } else {
                lines[lineId].delay = 'å®šåˆ»';
                logMessage = `${lineName}ã®é‹è¡ŒçŠ¶æ³ã‚’é€šå¸¸é‹è»¢ã«å¾©æ—§ã€‚`;
            }

            renderLineStatus();
            logEvent("é‹è¡ŒæŒ‡ä»¤", logMessage, logType);
            delayInputEl.value = ''; // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
        }

        function simulateDisasterEvent() {
            // å…¨è·¯ç·šã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ç½å®³ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const affectedLines = [];
            
            Object.keys(lines).forEach(key => {
                if (Math.random() > 0.3) { // 70%ã®ç¢ºç‡ã§å½±éŸ¿
                    lines[key].status = 'stopped';
                    lines[key].delay = 'çµ‚æ—¥è¦‹åˆã‚ã›';
                    affectedLines.push(lines[key].name);
                }
            });

            if (affectedLines.length > 0) {
                renderLineStatus();
                logEvent("ã‚·ã‚¹ãƒ†ãƒ è­¦å ±", `ğŸš¨ åºƒåŸŸç½å®³ç™ºç”Ÿï¼ ${affectedLines.join(', ')}ã®é‹è¡Œã‚’å³æ™‚è¦‹åˆã‚ã›ã€‚å…¨äººå“¡é…ç½®ã‚’è¦è«‹ã€‚`, "alert");
            } else {
                logEvent("ã‚·ã‚¹ãƒ†ãƒ è­¦å ±", "ç½å®³ã‚¤ãƒ™ãƒ³ãƒˆã‚’è©¦è¡Œã—ã¾ã—ãŸãŒã€å½±éŸ¿ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", "info");
            }
        }
        
        // =========================================================
        // IV. ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°
        // =========================================================

        function logEvent(source, message, type = "info") {
            const entry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            entry.className = 'log-entry';
            
            let typeClass = '';
            if (type === 'warn') {
                typeClass = 'log-warn';
            } else if (type === 'alert') {
                typeClass = 'log-alert';
            } else {
                typeClass = 'log-info';
            }

            entry.innerHTML = `<span class="${typeClass}">[${timestamp}] [${source}] ${message}</span>`;
            
            // æœ€æ–°ã®ãƒ­ã‚°ã‚’ä¸Šã«è¿½åŠ 
            eventLogEl.prepend(entry);

            // ãƒ­ã‚°ãŒå¤šã™ããŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
            if (eventLogEl.children.length > 100) {
                eventLogEl.removeChild(eventLogEl.lastChild);
            }
        }
    </script>
</body>
</html>
